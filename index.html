<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory System</title>
    <link rel="stylesheet" href="style.css">
    <script src="js/localization.js"></script>
</head>
<body>
    <div class="container">
        <div class="header-bar">
            <h1 data-i18n="Inventory System">Inventory System</h1>
            <div class="top-actions">
            <div class="save-file-action">
                <button id="saveToFileButton" class="save-file-button" onclick="handleSaveToFileClick()" data-i18n-title="never_exported">Save to file (0 changes)</button>
            </div>
            <div class="user-select">
                <span data-i18n="Current User:">Current User: </span>
                <select id="userSelect" onchange="changeUser(this.value)"></select>
            </div>
            <div class="location-select">
                <button onclick="openFloorPlan()" class="floor-plan-button" data-i18n="Floor Plan">Floor Plan</button>
            </div>
            <div class="data-actions">
                <button onclick="openBarcodeScanner()" data-i18n="Scan Barcode">Scan Barcode</button>
                <button onclick="openSettings()">‚öôÔ∏è <span data-i18n="Settings">Settings</span></button>
            </div>
            </div>
        </div>

        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Search items..." data-i18n-placeholder="Search items...">
        </div>
        <div id="locationFilterButtons" class="location-filter-buttons"></div>

        <div id="pendingInvoices" class="pending-invoices">
            <h2 data-i18n="Pending Invoices">Pending Invoices</h2>
            <div id="pendingInvoicesList"></div>
        </div>
            <span data-i18n="Example:">Example:</span> TODAY 100ML 10B125 22B1024 99 B 01 26
        <div class="add-item-form">
            <input type="text" id="itemName" placeholder="Item Name" data-i18n-placeholder="Item Name">
            <input type="number" id="itemQuantity" placeholder="Quantity" data-i18n-placeholder="Quantity">
            <input type="number" id="itemPrice" placeholder="Price" data-i18n-placeholder="Price">
            <button onclick="addItem()" data-i18n="Add Item">Add Item</button>
        </div>

        <table id="inventoryTable">
            <thead>
                <tr>
                    <th id="thName" onclick="setSort('name')">Name <span id="sortIconName"></span></th>
                    <th id="thQuantity" onclick="setSort('quantity')">Quantity <span id="sortIconQuantity"></span></th>
                    <th id="thPrice" onclick="setSort('price')">Price <span id="sortIconPrice"></span></th>
                    <th data-i18n="Actions">Actions</th>
                </tr>
            </thead>
            <tbody id="inventoryBody"></tbody>
        </table>
        <div id="inventoryPagination" class="pagination-controls"></div>

        <div class="history-section">
            <h2 data-i18n="Change History">Change History</h2>
            <div id="historyList"></div>
            <div id="historyPagination" class="pagination-controls"></div>
        </div>
    </div>

    <!-- Floor Plan Modal -->
    <div id="floorPlanModal" class="floor-plan-modal">
        <div class="floor-plan-content">
            <div class="floor-plan-header">
            <h2><span data-i18n="Floor Plan">Floor Plan</span> - <span id="floorPlanLocationName"></span></h2>
                <div class="floor-plan-header-actions">
                    <button class="save-btn" onclick="saveFloorPlan()" data-i18n="Save Floor Plan">Save Floor Plan</button>
                    <span class="floor-plan-close" onclick="closeFloorPlan()">&times;</span>
                </div>
            </div>
            
            <div class="floor-plan-editor">
                <div class="floor-plan-tools">
                    <button class="shape-button active" data-tool="select" onclick="selectTool('select')" data-i18n="Select">Select</button>
                    <button class="shape-button" data-tool="rectangle" onclick="selectTool('rectangle')" data-i18n="Rectangle">Rectangle</button>
                    <button class="shape-button" data-tool="circle" onclick="selectTool('circle')" data-i18n="Circle">Circle</button>
                    <button class="shape-button" data-tool="text" onclick="selectTool('text')" data-i18n="Text">Text</button>
                     <button class="shape-button" data-tool="delete" onclick="selectTool('delete')" data-i18n="Delete Floor Plan">Delete</button>
                    <input type="color" class="color-picker" id="shapeColor" value="#CCCCCC">
                     <div class="zoom-controls">
                         <button onclick="zoomFloorPlan(-0.1)" class="zoom-button">-</button>
                         <span id="zoomLevel">100%</span>
                         <button onclick="zoomFloorPlan(0.1)" class="zoom-button">+</button>
                         <button onclick="resetZoom()" class="zoom-button" data-i18n="Reset">Reset</button>
                     </div>
                    <div style="flex-grow: 1;"></div>
                    <button onclick="clearFloorPlan()" data-i18n="Clear All">Clear All</button>
                </div>
                
                <div class="floor-plan-canvas-container">
                    <div id="floorPlanCanvas" style="width: 1000px; height: 600px;"></div>
                    <div id="placedProducts"></div>
                </div>
                
                <div class="product-placement-panel">
                    <h3 data-i18n="Place Products on Floor Plan">Place Products on Floor Plan</h3>
                    <p data-i18n="Drag products onto the floor plan to show their locations">Drag products onto the floor plan to show their locations</p>
                    <div class="product-placement-list" id="productList"></div>
                </div>
                
                <div class="floor-plan-actions">
                    <button onclick="viewFloorPlan()" data-i18n="View Mode">View Mode</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add this after the floor plan modal -->
    <div id="scannerModal" class="scanner-modal">
        <div class="scanner-content">
            <span class="scanner-close" onclick="closeBarcodeScanner()">&times;</span>
            <h2 data-i18n="Scan Barcode">Scan Barcode</h2>
            
            <div id="scanner-container">
                <video id="video" autoplay playsinline></video>
                <canvas id="scanner-canvas"></canvas>
            </div>
            
            <div id="scannerResult" class="scanner-result"></div>
            <div id="productResult" class="product-result"></div>
            
            <div class="scanner-status" id="scanner-status" data-i18n="Ready to scan...">Ready to scan...</div>
            
            <div class="scanner-buttons">
                <button onclick="switchCamera()" class="switch-camera" data-i18n="Switch Camera">Switch Camera</button>
                <button onclick="closeBarcodeScanner()" data-i18n="Close">Close</button>
            </div>
        </div>
    </div>

    <!-- Add the barcode assignment modal -->
    <div id="barcodeModal" class="barcode-modal">
        <div class="barcode-content">
            <span class="barcode-close" onclick="closeBarcodeModal()">&times;</span>
            <h2 data-i18n="Assign Barcode">Assign Barcode</h2>
            <p id="barcodeProductName"></p>
            
            <div class="barcode-form">
                <div class="barcode-input-group">
                    <input type="text" id="barcodeInput" placeholder="Enter barcode" data-i18n-placeholder="Enter barcode">
                    <button class="scan-btn" onclick="scanBarcodeForProduct()"><i class="fas fa-camera"></i> <span data-i18n="Scan">Scan</span></button>
                </div>
                <button class="save-btn" onclick="saveBarcode()" data-i18n="Save Barcode">Save Barcode</button>
            </div>
        </div>
    </div>

    <!-- Add settings modal -->
    <div id="settingsModal" class="settings-modal">
        <div class="settings-content">
            <span class="settings-close" onclick="closeSettings()">&times;</span>
            <h2 data-i18n="Settings">Settings</h2>
            
            <div class="settings-tabs">
                <button class="settings-tab active" onclick="switchSettingsTab('theme')" data-i18n="settings_theme">Theme</button>
                <button class="settings-tab" onclick="switchSettingsTab('data')" data-i18n="settings_data">Data</button>
                <button class="settings-tab" onclick="switchSettingsTab('users')" data-i18n="settings_users">Users</button>
                <button class="settings-tab" onclick="switchSettingsTab('locations')" data-i18n="settings_locations">Locations</button>
            </div>
            
            <div id="themeSettings" class="settings-panel active">
                <h3 data-i18n="Theme Settings">Theme Settings</h3>
                <div class="settings-item">
                    <label data-i18n="Dark Mode">Dark Mode</label>
                    <div class="theme-toggle-container">
                        <label class="theme-toggle-label">üåô</label>
                        <label class="theme-toggle">
                            <input type="checkbox" id="settingsThemeCheckbox" onchange="toggleThemeFromSettings()">
                            <span class="theme-toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            
            <div id="dataSettings" class="settings-panel">
                <h3 data-i18n="Data Management">Data Management</h3>
                <div class="settings-item">
                    <label data-i18n="Export Data">Export Data</label>
                    <button onclick="exportData()" data-i18n="Export to JSON">Export to JSON</button>
                </div>
                <div class="settings-item">
                    <label data-i18n="Import Data">Import Data</label>
                    <button onclick="importData()" data-i18n="Import from JSON">Import from JSON</button>
                    <input type="file" id="settingsImportFile" accept=".json" style="display: none;" onchange="handleImportFile(event)">
                </div>
                <div class="settings-item">
                    <label data-i18n="Rebuild from History">Rebuild from History</label>
                    <button onclick="confirmRebuildFromHistory()" data-i18n="Rebuild">Rebuild</button>
                </div>
                <div class="settings-item">
                    <label data-i18n="Clear All Data">Clear All Data</label>
                    <button onclick="confirmClearData()" class="danger-btn" data-i18n="Clear Database">Clear Database</button>
                </div>
            </div>
            
            <div id="usersSettings" class="settings-panel">
                <h3 data-i18n="User Management">User Management</h3>
                <div class="settings-item">
                    <label data-i18n="Add New User">Add New User</label>
                    <div class="settings-input-group">
                        <input type="text" id="newUserName" placeholder="User Name" data-i18n-placeholder="User Name">
                        <button onclick="addUserFromSettings()" data-i18n="Add">Add</button>
                    </div>
                </div>
                <div class="settings-item">
                    <label data-i18n="Existing Users">Existing Users</label>
                    <div id="usersList" class="settings-list"></div>
                </div>
            </div>
            
            <div id="locationsSettings" class="settings-panel">
                <h3 data-i18n="Location Management">Location Management</h3>
                <div class="settings-item">
                    <label data-i18n="Add New Location">Add New Location</label>
                    <div class="settings-input-group">
                        <input type="text" id="newLocationName" placeholder="Location Name" data-i18n-placeholder="Location Name">
                        <button onclick="addLocationFromSettings()" data-i18n="Add">Add</button>
                    </div>
                </div>
                <div class="settings-item">
                    <label data-i18n="Existing Locations">Existing Locations</label>
                    <div id="locationsList" class="settings-list"></div>
                </div>
            </div>
            <div class="settings-item">
                <label data-i18n="settings_language">Language</label>
                <select id="languageSelect" onchange="changeLanguage(this.value)"></select>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/idb@8/build/umd.js"></script>
    <script src="js/db.js"></script>
    <script src="js/toast.js"></script>
    <script src="https://unpkg.com/konva@9/konva.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2/dist/quagga.min.js"></script>
    <script src="js/floorplan.js"></script>
    <script type="module">
        import { BrowserMultiFormatReader, NotFoundException } from 'https://cdn.jsdelivr.net/npm/@zxing/library@0.21.3/+esm';
        window.BrowserMultiFormatReader = BrowserMultiFormatReader;
        window.NotFoundException = NotFoundException;
    </script>
    <script src="js/barcode.js"></script>
    <script src="js/invoice.js"></script>
    <script src="js/settings.js"></script>
    <script src="index.js"></script>
</body>
</html> 